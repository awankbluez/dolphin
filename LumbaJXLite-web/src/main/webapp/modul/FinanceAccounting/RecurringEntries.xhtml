<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../../template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="content">
        <p:panel id="PanelRecurring" header="Recurring Entries" closable="true" toggleSpeed="500" closeSpeed="500">  
            <h:form id="FormRecurring">
                <p:growl id="createstatus" sticky="false" life="5000"/>
                <h:panelGrid columns="4">

                    <h:outputText value="Judul"/>
                    <p:inputText value="#{RecurringEntryBean.recurringEntry.descriptionrecurring}"/>
                    <p:spacer/>
                    <p:spacer/>

                    <h:outputText value="Kantor Cabang"/>
                    <p:selectOneMenu id="Branch" style="width: 200px;" value="#{RecurringEntryBean.recurringEntry.masteroperationalid}">
                        <f:selectItems value="#{RecurringEntryBean.branchs}" />
                    </p:selectOneMenu>
                    <p:spacer/>
                    <p:spacer/>

                    <h:outputText value="Periode"/>
                    <p:inputText value="#{RecurringEntryBean.recurringEntry.period}"/>
                    <h:outputText value="Times"/>
                    <p:selectBooleanCheckbox itemLabel="Continous" value="#{RecurringEntryBean.recurringEntry.continous}"/>

                    <h:outputText value="Frekuensi"/>
                    <p:selectOneMenu style="width: 200px;" value="#{RecurringEntryBean.recurringEntry.frequency}">
                        <f:selectItem itemLabel="Pilih Subject" itemValue=""/>
                        <f:selectItem itemLabel="Day" itemValue="1"/>
                        <f:selectItem itemLabel="Weekly" itemValue="2"/>
                        <f:selectItem itemLabel="Month" itemValue="3"/>
                        <f:selectItem itemLabel="Year" itemValue="4"/>
                    </p:selectOneMenu>
                    <p:spacer/>
                    <p:spacer/>

                    <h:outputText value="Start Run"/>
                    <p:calendar value="#{RecurringEntryBean.recurringEntry.startrun}"  pattern="yyyy-MM-dd" navigator="true" yearRange="c-120:c+20" readOnlyInputText="true"/>
                    <p:spacer/>
                    <p:spacer/>

                    <p:selectBooleanCheckbox itemLabel="Interval" value="#{RecurringEntryBean.recurringEntry.intervalcheck}"/>
                    <p:inputText value="#{RecurringEntryBean.recurringEntry.intervalvalue}"/>
                    <p:spacer/>
                    <p:spacer/>

                    <h:outputText value="Currency"/>
                    <p:selectOneMenu id="currency" style="width: 200px;" value="#{RecurringEntryBean.recurringEntry.currency.currencyID}">
                        <f:selectItems value="#{RecurringEntryBean.currencys}" var="currency" itemValue="#{currency.currencyID}" itemLabel="#{currency.currencyDescribe}"/>
                    </p:selectOneMenu>
                    <p:spacer/>
                    <p:spacer/>

                    <p:spacer/>
                    <p:selectBooleanCheckbox itemLabel="Aktif" value="#{RecurringEntryBean.recurringEntry.status}"/>
                    <p:spacer/>
                    <p:spacer/>

                </h:panelGrid>

                <p:panel id="panelentry" style="border: 0">

                    <p:fieldset id="xxsd" legend="#{msgs.newentry}"
                                toggleable="true"
                                collapsed="false"
                                toggleSpeed="500">
                        <fieldset>
                            <legend>Header</legend>

                            <h:panelGrid id="panelgridentry2" columns="3">
                                <h:outputText value="No Reff"/>
                                <p:inputText value="#{RecurringEntryBean.reffsementara+1}" disabled="true"/>
                                <p:spacer/>

                                <h:outputText value="Header Description"/>
                                <p:inputText id="headerdesc" value="#{RecurringEntryBean.journalEntryHeader.descriptionheader}" required="true" requiredMessage="Harus Di Isi" disabled="#{RecurringEntryBean.disableheaderdesc}"/>
                                <p:message id="messageheaderdesc" for="headerdesc"/>

                                <h:outputLabel for="newDate" value="#{msgs.date}"/>
                                <p:calendar id="newDate" value="#{RecurringEntryBean.journalEntryHeader.creationdate}" pattern="yyyy-MM-dd" navigator="true" yearRange="c-120:c+20" readOnlyInputText="true" disabled="true"/>
                                <p:spacer/>
                            </h:panelGrid>
                        </fieldset>
                        <fieldset>
                            <h:panelGrid id="panelgridentry" columns="4">

                                <h:outputLabel value="menggunakan contra"/>
                                <p:selectOneRadio  value="#{RecurringEntryBean.usecontra}" >
                                    <f:selectItem itemValue="true" itemLabel="Ya"/>
                                    <f:selectItem itemValue="false" itemLabel="Tidak" />
                                    <p:ajax update="panelgridentry"/>
                                </p:selectOneRadio>
                                <p:spacer/>
                                <p:spacer/>

                                <h:outputLabel for="newDescription" value="#{msgs.description}"/>
                                <p:inputText id="newDescription" value="#{RecurringEntryBean.journalEntry.description}"/>
                                <p:message for="newDescription"/>
                                <p:spacer/>

                                <h:outputLabel for="transDate" value="Transaction Date"/>
                                <p:calendar id="transDate" value="#{RecurringEntryBean.journalEntry.transactiondate}" pattern="yyyy-MM-dd" navigator="true" yearRange="c-120:c+20" readOnlyInputText="true"/>
                                <p:message for="transDate"/>
                                <p:spacer/>

                                <h:outputLabel value="#{msgs.coa}"/>
                                <p:inputText id="coa" disabled="true" value="#{RecurringEntryBean.journalEntry.chartofaccount.chartofaccountname}" style="width: 250px"/>
                                <p:commandButton action="#{RecurringEntryBean.searchcoa}" value="Cari" update=":formsearchcoa" onclick="dlg.show();" />
                                <p:spacer/>

                                <h:outputLabel for="newKreditDebet" value="#{msgs.coadebetcredit}"/>
                                <p:selectOneRadio id="newKreditDebet" value="#{RecurringEntryBean.journalEntry.credit}" >
                                    <f:selectItem itemValue="false" itemLabel="#{msgs.debet}"/>
                                    <f:selectItem itemValue="true" itemLabel="#{msgs.credit}"/>
                                </p:selectOneRadio>
                                <p:message for="newKreditDebet"/>
                                <p:spacer/>

                                <h:outputLabel id="outputcontra" value="contra" rendered="#{RecurringEntryBean.usecontra == true}"/>
                                <p:inputText id="contra" disabled="true" value="#{RecurringEntryBean.journalEntry.contrachartofaccount.chartofaccountname}"  rendered="#{RecurringEntryBean.usecontra == true}" style="width: 250px"/>
                                <p:commandButton id="buttoncontra" action="#{RecurringEntryBean.searchcontra}" value="Cari" update=":formsearchcoa" onclick="dlg2.show();" rendered="#{RecurringEntryBean.usecontra == true}" />
                                <p:spacer id="spacercontra" rendered="#{RecurringEntryBean.usecontra == true}"/>

                                <h:outputLabel for="newAmount" value="#{msgs.amount}"/>
                                <p:inputText id="newAmount" value="#{RecurringEntryBean.journalEntry.amount}">
                                    <f:convertNumber pattern="###.#####" />
                                </p:inputText>
                                <p:message for="newAmount"/>
                                <p:spacer/>
                                <p:commandButton id="btn_add" process="panelgridentry" value="Add to list" update="tableJournal amountView debetcredit save headerdesc" actionListener="#{RecurringEntryBean.nambah()}"/>
                            </h:panelGrid>
                        </fieldset>
                    </p:fieldset>

                    <p:dataTable
                        id="tableJournal"
                        widgetVar="tableJournal"
                        emptyMessage="#{msgs.norecordjournalentry}"
                        value="#{RecurringEntryBean.listjournalentry}"
                        var="entry"
                        paginator="true"
                        paginatorPosition="bottom"
                        rows="10"
                        rowsPerPageTemplate="10,20,50"
                        sortOrder="descending"
                        >

                        <p:column headerText="#{msgs.reff}" footerText="Jumlah">
                            <h:outputText value="#{entry.refferencenumber}"/>
                        </p:column>
                        <p:column headerText="#{msgs.description}">
                            <h:outputText value="#{entry.description}"/>
                        </p:column>
                        <p:column headerText="#{msgs.transactiondate}">
                            <h:outputText value="#{entry.transactiondate}">
                                <f:convertDateTime pattern="yyyy-MM-dd" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{msgs.akun}">
                            <h:outputText value="#{entry.chartofaccount.generalaccountnumber} || #{entry.chartofaccount.chartofaccountname}"/>
                        </p:column>
                        <p:column headerText="#{msgs.debet}" footerText="#{RecurringEntryBean.sumdebet}">
                            <h:outputText value="#{entry.amount}" rendered="#{entry.credit == false}">
                                <f:convertNumber pattern="###.#####" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{msgs.credit}" footerText="#{RecurringEntryBean.sumcredit}">
                            <h:outputText value="#{entry.amount}" rendered="#{entry.credit == true}">
                                <f:convertNumber pattern="###.#####" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="aksi">
                            <p:commandButton value="hapus"  update="@form" process="@form" actionListener="#{RecurringEntryBean.amountvalue(entry.credit, entry.amount)}">
                                <p:collector value="#{entry}"  
                                             removeFrom="#{RecurringEntryBean.listjournalentry}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>

                    <p:commandButton id="save" value="Save" actionListener="#{RecurringEntryBean.createjournal()}" update="@form" disabled="#{RecurringEntryBean.status != 'balance'}"/>
                    <p:commandButton value="Print" type="button" icon="ui-icon ui-icon-print">  
                        <p:printer target="tableJournal" />  
                    </p:commandButton>

                    <p:panel header="Difference" id="difference">
                        <h:panelGrid columns="4">
                            <h:outputLabel value="#{msgs.amount}" for="amountView" />
                            <p:inputText id="amountView" disabled="true" value="#{ (RecurringEntryBean.balance &lt; 0) ? RecurringEntryBean.balance * -1 : RecurringEntryBean.balance}">
                                <f:convertNumber pattern="###.#####" />
                            </p:inputText>
                            <p:inputText id="debetcredit" disabled="true" value="#{RecurringEntryBean.status}"/>
                        </h:panelGrid>
                    </p:panel>

                </p:panel>

            </h:form>

            <p:dialog id="Dialogcoa" header="Search Coa" widgetVar="dlg" modal="true" draggable="true" resizable="true" height="500"> 

                <h:form id="formsearchcoa">
                    <h:panelGrid columns="2" columnClasses="label, value" styleClass="grid">

                        <h:outputText value="number COA"/>
                        <p:inputText value="#{RecurringEntryBean.chartofaccount.generalaccountnumber}"/>

                        <h:outputText value="nama COA"/>
                        <p:inputText value="#{RecurringEntryBean.chartofaccount.chartofaccountname}"/>

                        <h:outputLabel for="Category" value="#{msgs.category}"/>
                        <p:selectOneMenu id="Category" value="#{RecurringEntryBean.chartofaccount.category.categoryid}" style="width: 150px;" required="true" >
                            <f:selectItem itemLabel="All Category" itemValue="0"/>
                            <f:selectItems value="#{RecurringEntryBean.categorylist}" var="category" itemLabel="#{category.categoryname}" itemValue="#{category.categoryid}"/>
                        </p:selectOneMenu>


                        <p:commandButton value="cari" action="#{RecurringEntryBean.searchcoa()}" update="@form"/>

                    </h:panelGrid>

                    <p:dataTable style="text-align: center" 
                                 value="#{RecurringEntryBean.listchartofaccountssearch}" 
                                 sortOrder="desc" 
                                 emptyMessage="#{msgs.emptymessage}" 
                                 var="searchcoa" 
                                 paginator="true" 
                                 paginatorPosition="top" 
                                 rows="10" 
                                 rowsPerPageTemplate="10,20,25"
                                 >


                        <p:column headerText="nomor">
                            <p:commandLink value="#{searchcoa.generalaccountnumber}" actionListener="#{RecurringEntryBean.selectedcoa(searchcoa)}"  update=":FormRecurring:coa" onclick="dlg.hide();"/>
                        </p:column>
                        <p:column headerText="name" filterBy="#{searchcoa.chartofaccountname}" filterMatchMode="contains">
                            <p:commandLink value="#{searchcoa.chartofaccountname}" actionListener="#{RecurringEntryBean.selectedcoa(searchcoa)}" update=":FormRecurring:coa" onclick="dlg.hide();"/>
                        </p:column>
                    </p:dataTable>   

                </h:form>
            </p:dialog>  
            
            
            <p:dialog id="Dialogcontra" header="Search Coa" widgetVar="dlg2" modal="true" draggable="true" resizable="true" height="500"> 
                <h:form id="formsearchcontra">
                    <h:panelGrid columns="2" columnClasses="label, value" styleClass="grid">

                        <h:outputText value="number COA"/>
                        <p:inputText value="#{RecurringEntryBean.chartofaccount.generalaccountnumber}"/>

                        <h:outputText value="nama COA"/>
                        <p:inputText value="#{RecurringEntryBean.chartofaccount.chartofaccountname}"/>

                        <h:outputLabel for="Category" value="#{msgs.category}"/>
                        <p:selectOneMenu id="Category" value="#{RecurringEntryBean.chartofaccount.category.categoryid}" style="width: 150px;" required="true" >
                            <f:selectItem itemLabel="All Category" itemValue="0"/>
                            <f:selectItems value="#{RecurringEntryBean.categorylist}" var="category" itemLabel="#{category.categoryname}" itemValue="#{category.categoryid}"/>
                        </p:selectOneMenu>


                        <p:commandButton value="cari contra" action="#{RecurringEntryBean.searchcontra()}" update="@form"/>

                    </h:panelGrid>

                    <p:dataTable style="text-align: center" 
                                 value="#{RecurringEntryBean.listcontrasearch}" 
                                 sortOrder="desc" 
                                 emptyMessage="#{msgs.emptymessage}" 
                                 var="searchcontra" 
                                 paginator="true" 
                                 paginatorPosition="top" 
                                 rows="10" 
                                 rowsPerPageTemplate="10,20,25"
                                 >


                        <p:column headerText="nomor">
                            <p:commandLink value="#{searchcontra.generalaccountnumber}" actionListener="#{RecurringEntryBean.selectedcontra(searchcontra)}"  update=":FormRecurring:contra" onclick="dlg2.hide();"/>
                        </p:column>
                        <p:column headerText="name" filterBy="#{searchcontra.chartofaccountname}" filterMatchMode="contains">
                            <p:commandLink value="#{searchcontra.chartofaccountname}" actionListener="#{RecurringEntryBean.selectedcontra(searchcontra)}" update=":FormRecurring:contra" onclick="dlg2.hide();"/>
                        </p:column>
                    </p:dataTable>   
                </h:form>
            </p:dialog>
        </p:panel>

    </ui:define>
</ui:composition>
