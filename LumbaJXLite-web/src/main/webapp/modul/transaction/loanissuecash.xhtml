<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../../template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="content">
        <p:panel header="Loan Issue Cash" closable="true" toggleSpeed="500" closeSpeed="500">
            <h:form id="loanissuecash" prependId="false">
                <p:growl id="transactionsuccess" sticky="false" life="10000"/>
                <p:dataTable value="#{issuecash.daftarnasabah}" var="daftar" style="text-align: center">
                    <p:column headerText="#{msgs.referencenumber}" filterBy="#{daftar.loanissue.referencenumber}">
                        <h:outputText value="#{daftar.loanissue.referencenumber}"/>
                    </p:column>
                    <p:column headerText="CIF" filterBy="#{daftar.customer.customercode}" filterMatchMode="contains">
                        <h:outputText value="#{daftar.customer.customercode}"/>
                    </p:column>
                    <p:column headerText="#{msgs.customername}" filterBy="#{daftar.customer.customername}" filterMatchMode="contains">
                        <h:outputText value="#{daftar.customer.customername}"/>
                    </p:column>
                    <p:column headerText="#{msgs.accountNumber}" filterBy="#{daftar.account.accountcode}" filterMatchMode="contains">
                        <h:outputText value="#{daftar.account.accountcode}"/>
                    </p:column>
                    <p:column headerText="#{msgs.product}" filterBy="#{daftar.loan.loanname}" filterMatchMode="contains">
                        <h:outputText value="#{daftar.loan.loanname}"/>
                    </p:column>
                    <p:column headerText="#{msgs.disbursementdate}">
                        <h:outputText value="#{daftar.loanissue.issuedate}"/>
                    </p:column>
                    <p:column headerText="Jumlah yang Dicairkan">
                        <h:outputText value="#{daftar.loanissue.issueammount}">
                            <f:convertNumber currencySymbol="#{issuecash.applicationManagedBean.systemGlobal.currency.currencySymbol}" type="currency"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{msgs.Show}">
                        <p:commandButton icon="ui-icon ui-icon-search" title="#{msgs.Show}" disabled="#{issuecash.btnList}" actionListener="#{issuecash.choose(daftar)}" update="@this,:loanissuecash:panel"/>
                    </p:column>
                </p:dataTable>
                <p:panel style="border-color: white" id="panel" visible="#{issuecash.panel}">
                    <h:panelGrid columns="3">
                        <h:outputText value="Nomor Rekening"/>
                        <h:outputText value=":"/>
                        <p:inputText value="#{issuecash.transaction.account.accountcode}" disabled="true"/>

                        <h:outputText value="Nama Nasabah"/>
                        <h:outputText value=":"/>
                        <p:inputText value="#{issuecash.transaction.customer.customername}" disabled="true"/>

                        <h:outputText value="CIF"/>
                        <h:outputText value=":"/>
                        <p:inputText value="#{issuecash.transaction.customer.customercode}" disabled="true"/>

                        <h:outputText value="Produk"/>
                        <h:outputText value=":"/>
                        <p:inputText value="#{issuecash.transaction.loan.loanname}" disabled="true"/>

                        <h:outputText value="Nilai Pencairan"/>
                        <h:outputText value=":"/>
                        <pe:inputNumber value="#{issuecash.transaction.amount}" symbol="#{issuecash.applicationManagedBean.systemGlobal.currency.currencySymbol}" thousandSeparator="." decimalSeparator="," disabled="true"/>                        
                    </h:panelGrid>
                    <p:dataTable value="#{issuecash.detaildaftarnasabah}" var="detail" style="text-align: left; width: 310px">
                        <f:facet name="header">Daftar Biaya</f:facet>
                        <p:column headerText="Detail">
                            <h:outputText value="#{detail.loanissuedetail.detailname}"/>
                        </p:column>
                        <p:column headerText="Nilai">
                            <h:outputText value="#{detail.loanissuedetail.amount}">
                                <f:convertNumber currencySymbol="#{issuecash.applicationManagedBean.systemGlobal.currency.currencySymbol}" type="currency"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="Post" onclick="post.show()"/>
                    <h:outputText/>
                    <p:commandButton value="Cancel" onclick="cancel.show()"/>
                </p:panel>

                <p:confirmDialog message="Are you sure to post this transaction ?" header="Posting" widgetVar="post" closable="false">
                    <p:commandButton value="Yes" actionListener="#{issuecash.posting()}" process="@this">
                        <f:actionListener binding="#{headerBean.retrieveUserCashAmount()}"/>
                    </p:commandButton>
                    <p:commandButton value="No" onclick="post.hide()"/>
                </p:confirmDialog>
                <p:confirmDialog message="Are you sure to cancel this transaction ?" header="Cancel" widgetVar="cancel" closable="false">
                    <p:commandButton value="Yes" update="@form"
                                     action="#{issuecash.reset()}" immediate="true"/>
                    <p:commandButton value="No" onclick="cancel.hide()"/>
                </p:confirmDialog>                
                <p:dialog header="Posting fail" widgetVar="varFail" modal="true" closable="false">
                    <p:commandButton value="OK" onclick="varFail.hide()"/>
                </p:dialog>
            </h:form>
        </p:panel>
    </ui:define>
</ui:composition>